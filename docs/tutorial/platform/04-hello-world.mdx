---
title: Hello World!
description: All on your machine
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Hello World!

As always, the goal of every _Hello World!_ exercise is to give you a feel of the technology,
but also to superficially experience how the concepts you learned map to something more tangible.
Don't hesitate to expand the collapsed sections if you want to dive deep on certain points,
with a view to better understand the mechanics of it.

These first steps take inspiration from the CosmWasm [docs' hello world](https://docs.cosmwasm.com/docs/getting-started/intro),
and from the Cosmos SDK's [basic tutorial](https://tutorials.cosmos.network/tutorials/3-run-node/).
The difference is that after you have downloaded all the packages and dependencies,
you no longer need access to other online resources.

It offers two tracks, you can either do all your compilations and running natively on your computer,
or achieve the same in Docker. If you choose the Docker path, that allows you to hold off installing anything other than Docker.

## What will happen

Here are the steps you are going to complete:

- Build the blockchain code.
- Create a running Cosmos blockchain:
  - With a single running node.
  - With CosmWasm installed
- Compile a smart contract code.
- Store the code and deploy a smart contract instance.
- Interact with it.

Let's get started.

[Install pre-requisites](https://docs.cosmwasm.com/core/installation). Either on your computer, or install Docker.
Including [JQ](https://jqlang.github.io/jq/).

## Build your blockchain code

Clone **wasmd**, which is the _simd_ of CosmWasm, at [v0.53.2](https://github.com/CosmWasm/wasmd/tree/v0.53.2).

```shell
git clone https://github.com/CosmWasm/wasmd --branch v0.53.2
cd wasmd
```

Build the blockchain application.

<Tabs groupId="local-docker">
  <TabItem value="Local" default>
    ```shell
    make build
    ```
  </TabItem>
  <TabItem value="Docker">
    ```shell
    docker build --tag wasmd:0.53.2 .
    ```
  </TabItem>
</Tabs>

With this done, `.build/wasmd` or Docker's `wasmd:0.53.2` is your blockchain executable.


## Prepare your blockchain

After you have compiled your blockchain code, and before you can turn your focus to CosmWasm, you need a running blockchain.
This step has you prepare the blockchain application, test keys and a genesis file.

:::warning Are you a validator?

If you have previously used wasmd, you may already have data in your `~/.wasmd` folder.
It is typically safe to erase the `config` sub-folder. But **if you are a validator** on one of the wasmd networks,
this exercise is not safe, so stop right there or proceed at your own risks.

The Docker track also uses your local folder, by sharing it as a volume with the flag `-v $HOME/.wasmd:/root/.wasmd`,
so that you can switch to the local track at a later stage. Make space in the `~/.wasmd` folder:

```shell
rm -rf ~/.wasmd/config \
    ~/.wasmd/data \
    ~/.wasmd/wasm
```

:::

Initialize the blockchain application's genesis file and other configuration files.

<Tabs groupId="local-docker">
    <TabItem value="Local" default>
        ```shell
        ./build/wasmd init validator-1 \
            --chain-id learning-chain-1
        ```
    </TabItem>
    <TabItem value="Docker">
        ```shell
        docker run --rm -it \
            -v $HOME/.wasmd:/root/.wasmd \
            wasmd:0.53.2 \
            wasmd init validator-1 \
                --chain-id learning-chain-1
        ```
    </TabItem>
</Tabs>

If you are curious, you can see what was created in `~/.wasmd`.

Then you can add a convenient but low-safety key for Alice, who shall become the validator operator.

<Tabs groupId="local-docker">
    <TabItem value="Local" default>
        ```shell
        ./build/wasmd keys add alice \
            --keyring-backend test
        ```
    </TabItem>
    <TabItem value="Docker">
        ```shell
        docker run --rm -it \
            -v $HOME/.wasmd:/root/.wasmd \
            wasmd:0.53.2 \
            wasmd keys add alice \
                --keyring-backend test
        ```
    </TabItem>
</Tabs>

Make a note of the seed phrase so that you can reuse it in a Node.js REPL console.

To become a validator, Alice needs an initial balance in the staking token. Give her one:

<Tabs groupId="local-docker">
    <TabItem value="Local" default>
        ```shell
        ./build/wasmd genesis \
            add-genesis-account alice 100000000stake \
            --keyring-backend test
        ```
    </TabItem>
    <TabItem value="Docker">
        ```shell
        docker run --rm -it \
            -v $HOME/.wasmd:/root/.wasmd \
            wasmd:0.53.2 \
            wasmd genesis \
                add-genesis-account alice 100000000stake \
                --keyring-backend test
        ```
    </TabItem>
</Tabs>

Have Alice create and sign the token-staking transaction that will make Alice an initial validator.

<Tabs groupId="local-docker">
    <TabItem value="Local" default>
        ```shell
        ./build/wasmd genesis \
            gentx alice 70000000stake \
            --keyring-backend test \
            --chain-id learning-chain-1
        ```
    </TabItem>
    <TabItem value="Docker">
        ```shell
        docker run --rm -it \
            -v $HOME/.wasmd:/root/.wasmd \
            wasmd:0.53.2 \
            wasmd genesis \
                gentx alice 70000000stake \
                --keyring-backend test \
                --chain-id learning-chain-1
        ```
    </TabItem>
</Tabs>

The system tells you that a file has been created with a signed transaction in it.
Add this signed transaction to the genesis file so that Alice starts indeed as a validator.

<Tabs groupId="local-docker">
    <TabItem value="Local" default>
        ```shell
        ./build/wasmd genesis collect-gentxs
        ```
    </TabItem>
    <TabItem value="Docker">
        ```shell
        docker run --rm -it \
            -v $HOME/.wasmd:/root/.wasmd \
            wasmd:0.53.2 \
            wasmd genesis collect-gentxs
        ```
    </TabItem>
</Tabs>

:::info

The blockchain preparation is now done, and you need not redo the above steps if you restart this exercise at a later date.

:::

## Run your blockchain

:::info

If you stopped `wasmd` earlier, you can come back here and restart `wasmd` where you left it off.

:::

Run Alice's validating node to start the blockchain system and to interact with it.

<Tabs groupId="local-docker">
    <TabItem value="Local" default>
        ```shell
        ./build/wasmd start
        ```
    </TabItem>
    <TabItem value="Docker">
        ```shell
        docker run --rm -it \
            --name val-alice-1 \
            -v $HOME/.wasmd:/root/.wasmd \
            wasmd:0.53.2 \
            wasmd start
        ```
    </TabItem>
</Tabs>

Your node is now running and ready to receive smart contracts.

<details>
  <summary>Confirm you are set up correctly</summary>

If you are new to Cosmos, you may want to confirm that you are correctly set up. Other than looking at the block height
increasing in the log, a simple verification is to check Alice's balance if it is as expected in another terminal.
First, store her address:

<Tabs groupId="local-docker">
    <TabItem value="Local" default>
        ```shell
        alice=$(./build/wasmd keys show alice \
            --keyring-backend test \
            --address)
        ```
    </TabItem>
    <TabItem value="Docker">
        ```shell
        alice=$(docker run --rm -i \
            -v $HOME/.wasmd:/root/.wasmd \
            wasmd:0.53.2 \
            wasmd keys show alice \
                --keyring-backend test \
                --address | tr -d '\r')
        ```
    </TabItem>
</Tabs>

Confirm you have the correct address with:

```shell
echo -n $alice
```

Which returns something like **wasm1tev6xt4pgrnjpxwmvv7jrl8ph4x47wg5vcd0as**.
With that, you can query for her balance:

<Tabs groupId="local-docker">
    <TabItem value="Local" default>
        ```shell
        ./build/wasmd query bank balances $alice
        ```
    </TabItem>
    <TabItem value="Docker">
        ```shell
        docker exec val-alice-1 \
            wasmd query bank balances $alice
        ```
    </TabItem>
</Tabs>

The expected answer:

```yaml
balances:
- amount: "30000000"
  denom: stake
pagination:
  total: "1"
```

Indeed, she started with **100,000,000** and staked **70,000,000**, so she now has only **30,000,000**
remaining available. The staking rewards that she has accumulated are not available until they are collected.

</details>

## Compile your smart contract

With a running chain, you can start interacting with the CosmWasm module.
First you are going to download and compile a smart contract.

We will use the same `nameservice` smart contract of the [long running exercise](./05-first-contract.md)
but at the intermediate [`add-first-library`](https://github.com/b9lab/cw-my-nameservice/tree/add-first-library) branch.
In another terminal, start by cloning it and changing the directory.

```shell
git clone https://github.com/b9lab/cw-my-nameservice --branch add-first-library
cd cw-my-nameservice/contracts/nameservice
```

At this version of the contract, it compiles with Rust v1.80.1 to the WASM target.

<Tabs groupId="local-docker">
    <TabItem value="Local" default>
        ```shell
        rustup install 1.80.1
        rustup target add wasm32-unknown-unknown --toolchain 1.80.1
        RUSTFLAGS='-C link-arg=-s' cargo +1.80.1 wasm
        ```
    </TabItem>
    <TabItem value="Docker">
        ```shell
        docker run --rm -it \
            -v $(pwd):/root \
            -w /root \
            rust:1.80.1 \
            sh -c "rustup target add wasm32-unknown-unknown && \
            RUSTFLAGS='-C link-arg=-s' cargo +1.80.1 wasm"
        ```
    </TabItem>
</Tabs>

The compiled WebAssembly is located relative to the contract dir in `./target/wasm32-unknown-unknown/release/cw_my_nameservice.wasm`.
The file ends up at about 221 KB in size. In fact, the `RUSTFLAGS='-C link-arg=-s'` flag is there to reduce its size,
always a concern in blockchain. You can remove the flag as a test, and you should see that it then ends up at 1.5 MB in size.

Copy the file to the `~/.wasmd` so as to reuse it when storing the code on-chain. Make the folder if it is missing:

```shell
mkdir -p $HOME/.wasmd/wasm/code
cp $(pwd)/target/wasm32-unknown-unknown/release/cw_my_nameservice.wasm \
    $HOME/.wasmd/wasm/code/cw_my_nameservice.wasm
```

Note that the `~/.wasmd` path is also accessible by the Docker container running the blockchain app,
which makes it convenient for this exercise.

## Store your contract code

With the bytecode of the smart contract ready, you are about to interact with the running chain again.
Return to the `wasmd` directory, in a new shell.

Start with a simple initial CosmWasm query to see what code, if any, has already been stored.

<Tabs groupId="local-docker">
    <TabItem value="Local" default>
        ```shell
        ./build/wasmd query wasm list-code
        ```
    </TabItem>
    <TabItem value="Docker">
        ```shell
        docker exec val-alice-1 wasmd query wasm list-code
        ```
    </TabItem>
</Tabs>

As expected, it returns:

```yaml
code_infos: []
pagination: ...
```

It is time to store your first CosmWasm code with the `tx wasm store` command. Alice, who owns `stake` tokens, can do it.

<Tabs groupId="local-docker">
    <TabItem value="Local" default>
        ```shell
        ./build/wasmd tx wasm store $HOME/.wasmd/wasm/code/cw_my_nameservice.wasm \
            --from alice --keyring-backend test \
            --gas-prices 0.25stake --gas auto --gas-adjustment 1.3 \
            --chain-id learning-chain-1 \
            --yes --output json --broadcast-mode sync
        ```
    </TabItem>
    <TabItem value="Docker">
        ```shell
        docker exec val-alice-1 \
            wasmd tx wasm store /root/.wasmd/wasm/code/cw_my_nameservice.wasm \
            --from alice --keyring-backend test \
            --gas-prices 0.25stake --gas auto --gas-adjustment 1.3 \
            --chain-id learning-chain-1 \
            --yes --output json --broadcast-mode sync
        ```
    </TabItem>
</Tabs>

<details>
    <summary>If you are new to the Cosmos SDK</summary>

The structure of these commands is that:

1. `wasmd` is the name of the executable. It is already running with the `start` command.
    However, here you are executing it separately with different commands.
2. `query` or `tx` directs the execution to create a query object or a transaction object instead of running a blockchain.
3. `wasm` directs the execution to create query/tx objects for the `wasm` module.
4. The other parameters are those that are required to create the query/tx object.

After it has created and signed the object, `wasmd` sends it to the running blockchain through the standard local port,
unless you specify another host and port.

</details>

With `--broadcast-mode sync`, the command sends a transaction, but does not wait for it to be confirmed.
Instead, you get succinct information, including the transaction hash:

```json
{"height":"0","txhash":"34087EB0B74233E7E3C3AA9CE6EFCB4279130AF1C2BCAE992DD1E1D1775D02ED","codespace":"","code":0,"data":"","raw_log":"","logs":[],"info":"","gas_wanted":"0","gas_used":"0","tx":null,"timestamp":"","events":[]}
```

Make a note of this `txhash`, such as:

```shell
ns_store_txhash=34087EB0B74233E7E3C3AA9CE6EFCB4279130AF1C2BCAE992DD1E1D1775D02ED
```

With your specific value.
